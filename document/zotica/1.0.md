## 用語

### 本文フォント
Zotica の外側で指定されているフォントです。
Zotica では、数式記号を除いた数値や変数名などには、専用のフォントを用いず外側のフォントをそのまま継承して使うので、このフォントを指して「本文フォント」と呼ぶことにします。

### 数式フォント
Zotica で使われる専用の数式フォントです。
このリポジトリの `source/zenmath/resource/font.otf` に置かれています。

### 伸縮レベル
根号や括弧などの伸縮する記号の伸縮の度合いを表します。
伸縮する記号は、伸縮の度合いに合わせてフォントに複数の形状が登録されています。
伸縮していない状態をレベル 0 とし、伸びれば伸びるほどレベルは上がります。

一部の記号は、可変長に対応しています。
例えば括弧のパーレンは、端の曲がる部分と中央の直線部分が別々の文字として登録されており、直線部分の長さを調整することで、任意の大きさの括弧を作ることができるようになっています。
このような状態における伸縮レベルは ∞ とします。

## 共通クラス
Zotica のカスタム要素のいずれに対しても、以下のクラス名を付けることで、その要素の数式上の役割を明示して前後のスペーシングを調整することができます。

**`bin`**:
二項演算子であることを明示します。
左右に 4/18 em のスペースが追加されます。  
**`rel`**:
二項関係子であることを明示します。
左右に 5/18 em のスペースが追加されます。  
**`del`**:
コンマやセミコロンなどの区切り記号であることを明示します。
右にのみ 5/18 em のスペースが追加されます。  
**`fun`**:
関数名であることを明示します。
右にのみ 3/18 em のスペースが追加されますが、括弧 (`lp` クラスをもつ要素) が後続した場合はこのスペースは挿入されません。  
**`not`**:
先行する記号に重ね打ちする記号であることを明示します。
否定を表すスラッシュなどに使われる特殊なクラスです。  
**`ord`**:
通常の文字列であることを明示します。
スペーシングはなされません。
クラスを何も付けないのと同じです。  
**`lp`**:
括弧の左側 (開き括弧) であることを明示します。  
**`rp`**:
括弧の右側 (閉じ括弧) であることを明示します。  
**`cp`**:
集合の内包表記など括弧の間の区切り記号であることを明示します。
左右に 5/18 em のスペースが追加されます。

なお、余計なスペースが発生するのを防ぐため、ある要素の最初の子要素となっている場合は左側のスペースは削除され、ある要素の最後の子要素となっている場合は右側のスペースは削除されます。
これは、要素に以下のクラスを付けることで抑制できます。

**`lpres`**:
その要素の最初の子要素の左側のスペースをそのまま保持するようになります。  
**`rpres`**:
その要素の最後の子要素の右側のスペースをそのまま保持するようになります。

## 要素

### ルート (`math-root`)
```html
<math-root>
  <!-- 内容 -->
</math-root>
```
Zotica の数式のルート要素です。

### 数値 (`math-n`)
```html
<math-n> <!-- 数値 --> </math-n>
```
数式中の数値を表します。
要素の内容はテキストノードです。
基本的には、数字か小数点か桁区切り記号の列であって、その先頭に符号が付くかもしれない文字列が、この要素の内容になります。

なお、Zotica はハイフン (U+002D) をマイナス記号 (U+2212) に置き換えることはしません。
負の符号を表す正しい記号は U+2212 の方なので、注意してください。

### 識別子 (`math-i`)
```html
<math-i> <!-- 識別子名 --> </math-i>
```
数式中の識別子を表します。
要素の内容はテキストノードです。
識別子には、変数名や定数名や関数名などが含まれます。

何も指定しなければ、識別子は常に本文フォントのイタリック体で描画されます。
ただし、要素に `fun` クラスが付けられている場合は、例外的にローマン体で描画されます。
また、以下のクラスを追加することで、フォントを変更することができます。

**`rm`**:
ローマン体で描画します。  
**`bf`**:
ボールド体で描画します。
デフォルトがイタリック体なので、このクラスを付けただけではボールドイタリック体で描画されることになります。
ボールドローマン体で描画したい場合は、`rm` クラスと併用してください。  
**`alt`**:
カリグラフィー体やフラクトゥール体などを表示するために、数式フォントで描画します。
これらの書体の文字は Unicode 上の専用のブロック (U+1D400 ～ U+1D7FF と U+2100 ～ U+214F の一部) に収録されていますが、そこの文字への自動変換は行われません。
あくまで、数式フォントで描画するようになるだけです。

### 記号 (`math-o`)
```html
<math-o> <!-- 記号 --> </math-o>
```
記号を表します。
要素の内容はテキストノードです。
記号には、演算子 (総和記号や積分記号などの大型演算子も含む), 関係子, 括弧, 区切り記号などが含まれます。
多くの場合、記号の種類を明示するために、共通クラスのいずれかが付けられます。

共通クラスの他に、以下のクラスを付けることができます。

**`txt`**:
本文フォントで描画するようになります。
記号というより文字に近い記号 (いわゆる文字様記号) を表示するのに利用できます。  
**`int`**:
大型の積分記号 (とそれに類する記号) を表します。
高さなどが調整されます。  
**`sum`**:
大型の総和記号 (とそれに類する記号) を表します。
高さなどが調整されます。  
**`acc`**:
アクセント記号を表します。
このクラスが付けられた場合、中身のテキストは結合用アクセント文字 1 文字であることが期待されます。
それ以外の文字が入れられた場合は、表示位置がおかしくなる可能性があります。  
**`wide`**:
幅の広いアクセント記号を表します。
このクラスが付けられた場合、中身のテキストは U+F0000 ～ U+F04DB にある専用の文字であることが期待されます。
それ以外の文字が入れられた場合は、表示位置がおかしくなる可能性があります。

記号がある要素の最初の子要素になっている場合、それは後続する要素に係る一項演算子 (符号のようなもの) だと解釈され、左側のスペースに加え右側のスペースも削除されます。
ただし、その記号を含んでいる親要素に `lpres` クラスが指定されているときは、スペースの削除は行われません。

### テキスト (`math-text`)
```html
<math-text> <!-- テキスト --> </math-text>
```
数式ではない通常のテキストを表します。
要素の内容はテキストノードです。

### 分数 (`math-frac`)
```html
<math-frac>
  <math-num>
    <!-- 分子 -->
  </math-num>
  <math-denwrap>
    <math-line></math-line>
    <math-den>
      <!-- 分母 -->
    </math-den>
  </math-denwrap>
</math-frac>
```
分数を描画します。

`math-line` 要素は分数の括線を描画するのに使われるもので、内容は常に空です。

### 根号 (`math-sqrt`)
```html
<math-sqrt>
  <math-surd>
    <math-o> <!-- 根号記号 --> </math-o>
  </math-surd>
  <math-sqrtcont>
    <!-- 内容 -->
  </math-sqrtcont>
</math-sqrt>
```
根号を描画します。
根号記号は U+221A, U+F011D, U+F011E, U+F011F のいずれかです。

`math-sqrt` 要素に `mod` クラスを付けることで、Zotica が中身の高さに応じて自動的に根号記号を変更します。

### 下付きと上付き (`math-subsup`)
```html
<math-subsup>
  <math-base>
    <!-- ベース -->
  </math-base>
  <math-sub>
    <!-- 下付き -->
  </math-sub>
  <math-sup>
    <!-- 上付き -->
  </math-sup>
</math-subsup>
```
下付きと上付きをもつ数式を描画します。
下付きと上付きのいずれかが存在しない場合は、対応する要素 (`math-sub` 要素か `math-sup` 要素) を省略することができます。

`math-subsup` 要素には以下のクラスがあります。

**`int`**:
大型の積分記号とその添字を描画するのに使われます。
このクラスが付けられた場合、`math-base` 要素の内容として、`int` クラスをもつ `math-o` 要素が 1 つ置かれることが想定されます。
下付き箇所が、積分記号の傾斜に合わせてより左に配置されるようになります。

上付きと下付きの位置は、ベースとなる数式の高さに応じて自動的に調整されます。

### オーバースクリプトとアンダースクリプト (`math-underover`)
```html
<math-underover>
  <math-base>
    <!-- ベース -->
  </math-base>
  <math-under>
    <!-- アンダースクリプト -->
  </math-under>
  <math-over>
    <!-- オーバースクリプト -->
  </math-over>
</math-underover>
```
アンダースクリプトとオーバースクリプトをもつ数式を描画します。
アンダースクリプトとオーバースクリプトのいずれかが存在しない場合は、対応する要素 (`math-under` 要素か `math-over` 要素) を省略することができます。

`math-underover` 要素には以下のクラスがあります。

**`sum`**:
大型の総和記号 (とそれに類する記号) とその添字を描画するのに使われます。
このクラスが付けられた場合、`math-base` 要素の内容として、`sum` クラスをもつ `math-o` 要素が 1 つ置かれることが想定されます。
現在では、このクラスを付けても付けなくても表示は変わりませんが、将来に仕様が変更されることがあるので、付けておくのが無難です。  
**`acc`**:
アクセント記号付きの文字を描画するのに使われます。
このクラスが付けられた場合、`math-over` 要素もしくは `math-under` 要素の内容として、`acc` クラスをもつ `math-o` 要素が 1 つ置かれることが想定されます。
ベースの文字に合わせて、アクセント記号の位置が自動的に調整されるようになります。  
**`wide`**:
幅の広いアクセント記号付きの文字を描画するのに使われます。
このクラスが付けられた場合、`math-over` 要素もしくは `math-under` 要素の内容として、`over` クラスをもつ `math-o` 要素が 1 つ置かれるか、`math-hstretch` 要素が 1 つ置かれることが想定されます。
アクセント記号の位置が調整されます。

### 括弧囲み (`math-paren`)
```html
<math-paren class="lp rp">
  <math-left>
    <!-- 左括弧 -->
  </math-left>
  <math-parencont>
    <!-- 左側内容 -->
  </math-parencont>
  <math-center class="cp">
    <!-- 区切り線 -->
  </math-center>
  <math-parencont>
    <!-- 右側内容 -->
  </math-parencont>
  <math-right>
    <!-- 右括弧 -->
  </math-right>
</math-paren>
```
括弧囲みの数式を描画します。
集合の内包表記のように、中央に区切り線を隔てて左右に数式があり、それ全体を括弧が囲んでいる場合は、上のように `math-left`, `math-parencont`, `math-center`, `math-parencont`, `math-right` の順で 5 つの要素を並べます。
区切り線がなく数式を括弧で囲むだけの場合は、`math-center` 要素と一方の `math-parencont` 要素は不要になり、`math-left`, `math-parencont`, `math-right` の順で 3 つの要素を並べます。

この要素は括弧囲みのためのものですが、共通クラスを明示的に指定しない限り、括弧の周囲に入るべきスペースは入れられません。
適切なスペーシングをするためには、`math-paren` 要素に `lp` と `rp` を、`math-center` 要素に `cp` を付けておく必要があります。

`math-left` 要素, `math-center` 要素, `math-right` 要素の内容としては、括弧記号を中身としてもつ `math-o` 要素が 1 つ置かれるか、`math-vstretch` 要素が置かれることが想定されます。

`math-paren` 要素に `mod` クラスを付けることで、Zotica が中身の高さに応じて自動的に括弧記号を変更します。
このとき、括弧の種類を明示するため、さらに `left-(左括弧の種類)`, `right-(右括弧の種類)`, `center-(区切り括弧の種類)` (例えば `left-paren`, `right-brace`, `center-vert` など) というクラスを付ける必要があります。
区切り線がない場合は `center-(区切り括弧の種類)` は不要です。
括弧の種類は以下の通りです。

**`paren`**:
通常の丸括弧です。  
**`pparen`**:
白抜きの丸括弧 (もしくは二重の丸括弧) です。  
**`bracket`**:
角括弧です。  
**`bbracket`**:
白抜きの角括弧 (もしくは二重の角括弧) です。
形式言語の意味を表す括弧 (いわゆるオックスフォードブラケット) としてよく用いられます。  
**`brace`**:
波括弧です。  
**`bbrace`**:
白抜きの波括弧 (もしくは二重の波括弧) です。  
**`vert`**:
縦線です。
絶対値記号として使われる他、集合の内包表記の区切り線としても使われます。  
**`vvert`**:
二重の縦線です。  
**`floor`**:
床関数を表す括弧です。  
**`ceil`**:
天井関数を表す括弧です。  
**`angle`**:
山括弧です。  
**`aangle`**:
二重の山括弧です。  
**`tort`**:
亀甲括弧です。
角括弧 (`bracket` の括弧) よりも上下隅の角張った部分の角度が緩やかになっています。

### 可変長括弧 (`math-vstretch`)

### 可変長アクセント記号 (`math-hstretch`)

### 表 (`math-table`)

### スペース (`math-space`)
```html
<math-space></math-space>
```
スペースを挿入します。
要素の内容は常に空です。

挿入するスペースの量は、クラス名によって指定します。
以下のクラスがあります。

**`asfun`**:
関数名 (`fun` クラスをもつ要素) の右に挿入されるスペースと同じ量のスペースを挿入します。
3/18 em です。  
**`asbin`**:
二項演算子 (`bin` クラスをもつ要素) の左右に挿入されるスペースと同じ量のスペースを挿入します。
4/18 em です。  
**`asrel`**:
二項関係子 (`rel` クラスをもつ要素) の左右に挿入されるスペースと同じ量のスペースを挿入します。
5/18 em です。  
**`asmatrix`**:
行列 (`matrix` クラスをもつ `math-table` 要素) の成分間に入る水平方向のスペースと同じ量のスペースを挿入します。
15/18 em です。  
**`ascase`**:
場合分け (`case` クラスをもつ `math-table` 要素) の成分間に入る水平方向のスペースと同じ量のスペースを挿入します。
24/18 em です。  
**`superthin`**:
1/18 em のスペースを挿入します。  
**`verythin`**:
2/18 em のスペースを挿入します。  
**`medium`**:
3/18 em のスペースを挿入します。  
**`thick`**:
4/18 em のスペースを挿入します。  
**`verythick`**:
5/18 em のスペースを挿入します。  
**`superthick`**:
6/18 em のスペースを挿入します。  
**`half`**:
9/18 em のスペースを挿入します。  
**`em`**:
18/18 em のスペースを挿入します。  
**`sesqui`**:
27/18 em のスペースを挿入します。

### グループ化 (`math-group`)

### スタイル (`math-style`)