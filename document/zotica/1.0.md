## コマンドの構成
Zotica では、以下のような形式の「コマンド」と呼ばれる構文を組み合わせることで数式を記述します。
```
## 基本形
\コマンド名|属性="値",･･･,属性="値"|<引数>･･･<引数>
## 属性が存在しない場合
\コマンド名<引数>･･･<引数>
## 引数が存在しない場合
\コマンド名|属性="値",･･･,属性="値"|>
## 属性も引数も存在しない場合
\コマンド名>
```
属性の値が意味をもたない (属性の存在だけに意味がある) 場合は、値を省略することができます。
例えば、最初の属性の値を省略した場合、`\コマンド名|属性,属性="値",･･･,属性="値"|<引数>` のようになります。

常に複数の引数を渡すことができる点を除けば、Zotica のコマンドは ZenML の要素と同じ構文になっています。
したがって、文字のエスケープやコメントの方法などは ZenML に準じます。

コマンドによって意味のある属性や引数の個数は決まっていますが、属性や引数が余分に指定されていても、エラーにはならず単に無視されます。
また、引数が足りない場合でも、エラーにならず空ノードが指定されたと見なされます。

コマンドは、基本コマンドとユーティリティコマンドの 2 種類に分かれます。
基本コマンドとは、数式を記述するための最低限のコマンドの集まりです。
基本コマンドだけで (Zotica が対応している範囲の) あらゆる数式が書けますが、しばしば記述が冗長になってしまうので、より簡潔に書けるように用意されているのがユーティリティコマンドです。

## ギリシャ文字エスケープ
Zotica では、ZenML のエスケープ構文が拡張されていて、`` ` `` の直後にラテン文字を置くと対応するギリシャ文字に変換されます。
ラテン文字とギリシャ文字の対応は、[定義ファイル](../../source/zotica/resource/math.json) の `greek` キーを参照してください。

## アトムクラス
Zotica のコマンドのいずれに対しても、以下の属性を指定することができ、そのコマンドが表す数式要素の種類を指定することができます。
これらの属性は存在だけが意味をもちます。
ここで指定される数式要素の種類は「アトムクラス」と呼ばれ、左右に挿入されるスペースの量が変化します。

**`ord`**:
数値や変数名などの文字列であることを意味します。
スペーシングはなされません。  
**`bin`**:
二項演算子であることを意味します。
左右に 4/18 em のスペースが追加されます。  
**`rel`**:
二項関係子であることを意味します。
左右に 5/18 em のスペースが追加されます。  
**`sbin`**:
左右の空きが広めの二項演算子であることを意味します。
左右に 8/18 em のスペースが追加されます。  
**`srel`**:
左右の空きが広めの二項関係子であることを意味します。
左右に 8/18 em のスペースが追加されます。  
**`del`**:
コンマやセミコロンなどの区切り記号であることを意味します。
右にのみ 5/18 em のスペースが追加されます。  
**`fun`**:
関数名であることを意味します。
右にのみ 3/18 em のスペースが追加されますが、開き括弧 (`par` クラスか `lpar` クラスをもつ要素) が後続した場合はこのスペースは挿入されません。  
**`not`**:
先行する記号に重ね打ちする記号であることを意味します。
否定を表すスラッシュにのみ使われる特殊なクラスなので、このクラスを明示的に用いることはおそらくありません。  
**`par`**:
括弧で囲まれた部分であることを意味します。  
**`lpar`**:
括弧の左側 (開き括弧) であることを意味します。  
**`rpar`**:
括弧の右側 (閉じ括弧) であることを意味します。  
**`cpar`**:
集合の内包表記など括弧の間の区切り記号であることを明示します。
左右に 5/18 em のスペースが追加されます。

## テキストノードのパース
Zotica では、マークアップを簡便にするため、テキストノードは内容がパースされてコマンド列に変換されます。
具体的には、以下のような動作をします。

まず、全てのスペースは無視されます。
さらに、ハイフン (U+002D) とアスタリスク (U+002A) は、それぞれマイナス記号 (U+2212) とアスタリスク演算子 (U+2217) に置き換えられます。

その上で、数字 (Unicode カテゴリーが Number の文字) の連続した列は、まとめて `n` コマンドに変換されます。
アルファベット (Unicode カテゴリーが Letter か Mark の文字) は、1 文字ずつがそれぞれ 1 つの `i` コマンドに変換されます。
それ以外の文字は、1 文字ずつがそれぞれ 1 つの `o` コマンドに変換されます。

この `o` コマンドに変換される際、Zotica が同じ記号を出力するユーティリティコマンドを提供しているのであれば、そのコマンドを用いた場合に付けられるアトムクラスが自動的に付けられます。
同じ記号を出力するコマンドが存在しない場合は、`bin` クラスが付けられます。

アポストロフィー (U+0027) だけは例外で、`o` コマンドには変換されず、`\sp<><\pr>>` という記述に変換されます。

`n`, `i`, `op`, `o`, `bf`, `rm`, `bfrm`, `text`, `bb`, `cal`, `scr`, `frak` の 12 種類のコマンドでは、ここでのテキストノードのパースは行われず、テキストはそのまま保持されます。
このようなコマンドは、[定義ファイル](../../source/zotica/resource/math.json) の `leaf` キーで一覧できます。

## 基本コマンド

### 数値 (`n`)
```
\n<数値>
```
数値を記述します。

引数にはテキストノードのみを指定し、コマンドは含めないでください。

このコマンドを使用しなくてもテキスト内の数字列は数値だと解釈されるので、このコマンドを明示的に使うことは基本的にないでしょう。
ただし、特定の数字列に何らかのアトムクラスを付けたい場合には利用できるかもしれません。

### 識別子 (`i`)
```
\i<識別子>
```
変数名や関数名などの識別子を記述します。

引数にはテキストノードのみを指定し、コマンドは含めないでください。

識別子は常に本文フォントのイタリック体で描画されます。
以下の属性を指定することで、描画に用いるフォントを変更することができます。
これらの属性は存在だけが意味をもちます。

**`rm`**:
ローマン体で描画します。  
**`bf`**:
ボールド体で描画します。
デフォルトがイタリック体なので、このクラスを付けただけではボールドイタリック体で描画されることになります。
ボールドローマン体で描画したい場合は、`rm` 属性と併用してください。  
**`alt`**:
カリグラフィー体やフラクトゥール体などを表示するために、数式フォントで描画します。
これらの書体の文字は Unicode 上の専用のブロック (U+1D400 ～ U+1D7FF と U+2100 ～ U+214F の一部) に収録されていますが、そこの文字への自動変換は行われません。
あくまで、数式フォントで描画するようになるだけです。

テキストノードのパースでは、1 文字がそれぞれ 1 つの識別子と解釈されてしまうので、2 文字以上の識別子を記述したい場合はこのコマンド (か類似のユーティリティコマンド) を利用する必要があります。

### 記号 (`o`)
```
\o<記号>
```
演算子などの記号を記述します。

引数にはテキストノードのみを指定し、コマンドは含めないでください。

記号は常に数式フォントで描画されます。
以下の属性を指定することで、描画に用いるフォントを変更することができます。
これらの属性は存在だけが意味をもちます。

**`txt`**:
本文フォントで描画します。

だいたいの数学記号は、専用のユーティリティコマンドが用意されていて、そちらを利用する方が入力も簡単なため、`o` コマンドを明示的に用いることはほとんどないでしょう。
あらかじめ定義されている記号以外の記号を使いたいときに、この `o` コマンドが利用できます。

### テキスト (`text`)
```
\text<テキスト>
```
数式ではない通常のテキストを表します。

引数にはテキストノードのみを指定し、コマンドは含めないでください。

### 括弧 (`fence`)
```
\fence<内容>
```
括弧囲みの数式を描画します。

囲むのに用いる括弧やその大きさを、以下の属性で指定することができます。

**`l`**:
左側の括弧 (開き括弧) の種類を指定します。
省略した場合、`paren` が指定されたと見なされます。  
**`r`**:
右側の括弧 (閉じ括弧) の種類を指定します。
省略した場合、`paren` が指定されたと見なされます。  
**`s`**:
括弧の伸縮レベルを指定します。
`0` から `12` までの整数を指定してください。
括弧の種類によっては全ての伸縮レベルに対応していないことがありますが、そのような値が指定された場合は、最も大きい括弧で描画されます。
省略した場合、中身の数式要素の大きさに応じて適切な大きさが選択されます。

括弧の種類は以下から選択できます。
これらは[定義ファイル](../../source/zotica/resource/math.json) の `fence` キーで一覧できます。

**`paren`**:
通常の丸括弧です。  
**`pparen`**:
白抜きの丸括弧 (もしくは二重の丸括弧) です。  
**`bracket`**:
角括弧です。  
**`bbracket`**:
白抜きの角括弧 (もしくは二重の角括弧) です。
形式言語の意味を表す括弧 (いわゆるオックスフォードブラケット) としてよく用いられます。  
**`brace`**:
波括弧です。  
**`bbrace`**:
白抜きの波括弧 (もしくは二重の波括弧) です。  
**`vert`**:
縦線です。
絶対値記号として使われる他、集合の内包表記の区切り線としても使われます。  
**`vvert`**:
二重の縦線です。  
**`floor`**:
床関数を表す括弧です。  
**`ceil`**:
天井関数を表す括弧です。  
**`angle`**:
山括弧です。  
**`aangle`**:
二重の山括弧です。  
**`tort`**:
亀甲括弧です。
角括弧 (`bracket` の括弧) よりも上下隅の角張った部分の角度が緩やかになっています。  
**`none`**:
括弧を表示しません。
左右片方だけに括弧を付けたい場合に利用できます。

開き括弧と閉じ括弧が同じ場合は、括弧の種類と同名のユーティリティコマンドが用意されているので、そちらを使う方が簡便です。
ただし、半開区間を記述する場合など、開き括弧と閉じ括弧が異なる場合は、`fence` コマンドでしか描画できません。

### 区切り記号付き括弧 (`set`)
```
\set<左側内容><右側内容>
```
集合の内包表記のような、中央の区切り線を境として左右に数式要素をもつ括弧囲みの数式を描画します。

囲むのに用いる括弧やその大きさを、以下の属性で指定することができます。

**`l`**:
左側の括弧 (開き括弧) の種類を指定します。
省略した場合、`brace` が指定されたと見なされます。  
**`r`**:
右側の括弧 (閉じ括弧) の種類を指定します。
省略した場合、`brace` が指定されたと見なされます。  
**`c`**:
区切り線の種類を指定します。
省略した場合、`vert` が指定されたと見なされます。  
**`s`**:
括弧および区切り線の伸縮レベルを指定します。
`0` から `12` までの整数を指定してください。
括弧の種類によっては全ての伸縮レベルに対応していないことがありますが、そのような値が指定された場合は、最も大きい括弧で描画されます。
省略した場合、中身の数式要素の大きさに応じて適切な大きさが選択されます。

指定できる括弧の種類は `fence` コマンドと同様です。

### 下付きと上付き (`multi`)
```
\multi<核要素><右下添字><右上添字><左下添字><左上添字>
```
上付きや下付きなどの添字が付けられた数式を描画します。
各添字要素は核要素の大きさに基づいて配置されます。

多くの場合で添字は右側のみに付けられるため、右側の添字のみを記述できる引数の少ないユーティリティコマンド (`sb`, `sp`, `sbsp`) も用意されています。
左側の添字は `multi` コマンドを利用しないと記述できません。

### アンダースクリプトとオーバースクリプト (`unov`)
```
\unov<核要素><下添字><上添字>
```
核要素の真下もしくは真上に添字が付けられた数式を描画します。

真上もしくは真下のみに添え字を付けたい場合は、引数の少ないユーティリティコマンド (`un`, `ov`) も利用できます。

### 分数 (`frac`)
```
\frac<分子><分母>
```
分数を描画します。

### 根号 (`sqrt`)
```
\sqrt<内容><指数>
```
根号記号とその中身を描画します。

根号記号の大きさは、以下の属性で指定することができます。

**`s`**:
根号記号の伸縮レベルを指定します。
`0` から `3` までの整数を指定してください。
省略した場合、中身の数式要素の大きさに応じて適切な大きさが選択されます。

### 積分様記号 (`intlike`)
```
\intlike<下添字><上添字>
```
積分様記号とそれに付随する添字を描画します。

以下の属性が指定できます。

**`k`**:
積分様記号の種類を指定します。
指定できる値は後述します。  
**`in`**:
インライン数式用の小型の積分様記号で描画します。
これを省略した場合、ディスプレイ数式用の大型の積分様記号で描画します。
この属性は存在だけが意味をもちます。

積分様記号の種類のうち、主要なものを以下に示します。
これ以外にも、[定義ファイル](../../source/zotica/resource/math.json) の `integral` キーで定義されているものが利用できます。

**`int`**:
通常の積分記号です。  
**`iint`**:
二重積分記号です。  
**`iiint`**:
三重積分記号です。  
**`oint`**:
周回積分記号です。
通常の積分記号の中央に円が描かれます。

積分様記号の種類と同名のユーティリティコマンドが用意されているので、そちらを使う方が簡便です。
そのため、`intlike` コマンドを利用する場面はほとんどないでしょう。

### 総和様記号 (`sumlike`)
```
\sumlike<下添字><上添字>
```
総和様記号とそれに付随する添字を描画します。

以下の属性が指定できます。

**`k`**:
総和様記号の種類を指定します。
指定できる値は後述します。  
**`in`**:
インライン数式用の小型の総和様記号で描画し、添字を総和様記号の右上と右下に配置します。
これを省略した場合、ディスプレイ数式用の大型の総和様記号で描画し、添字を総和様記号の真上と真下に配置します。
この属性は存在だけが意味をもちます。

総和様記号の種類のうち、主要なものを以下に示します。
これ以外にも、[定義ファイル](../../source/zotica/resource/math.json) の `sum` キーで定義されているものが利用できます。

**`sum`**:
総和記号 (大きなギリシャ文字シグマ) です。  
**`prod`**:
総乗記号 (大きなギリシャ文字パイ) です。  
**`coprod`**:
直和や余積の記号です。
総乗記号を上下反転した形をしています。  
**`bigcap`**:
集合の共通部分を表す記号です。  
**`bigcup`**:
和集合を表す記号です。

総和様記号の種類と同名のユーティリティコマンドが用意されているので、そちらを使う方が簡便です。
そのため、`sumlike` コマンドを利用する場面はほとんどないでしょう。

### アクセント付き文字 (`accent`)

### 伸縮アクセント付き文字 (`wide`)

### 表 (`table`)

### 表のセル (`c`, `br`)

### 図式 (`diag`)

### 図式のセル (`v`, `br`)

### 図式の矢印とラベル (`ar`)

### グループ化 (`g`)

### 空間の確保 (`ph`)

### スペース (`s`)

## ユーティリティコマンド

### フォント指定した識別子 (`bf`, `rm`, `bfrm`)
```
\bf<識別子>  ≅ \i|bf|<識別子>
\rm<識別子>  ≅ \i|rm|<識別子>
\bfrm<識別子>  ≅ \i|bf,rm|<識別子>
```
フォントを指定した識別子を簡潔に書くためのユーティリティコマンドです。

いずれのコマンドでも、引数にはテキストノードのみを指定し、コマンドは含めないでください。

### 特殊フォントの識別子 (`bb`, `cal`, `scr`, `frak`)
```
\bb<文字>  ≅ \i|alt|<変換後の文字>
\cal<文字>  ≅ \i|alt|<変換後の文字>
\scr<文字>  ≅ \i|alt|<変換後の文字>
\frak<文字>  ≅ \i|alt|<変換後の文字>
```
黒板太字体やカリグラフィー体などの特殊フォントの文字を記述します。
通常のラテン文字や数字を、対応する Unicode 上の専用のブロックの文字に変換します。
`bb`, `cal`, `scr`, `frak` はそれぞれ黒板太字体, カリグラフィー体, スクリプト体, フラクトゥール体を意味します。

いずれのコマンドでも、引数にはテキストノードのみを指定し、コマンドは含めないでください。
また、そのテキストノードは、ラテンアルファベットもしくは通常の数字のみであるようにしてください。

### ユーザー定義関数 (`op`)
```
\op<関数名>  ≅ \i|fun,rm|<関数名>
```
lcm や supp などのユーザー定義の関数名を簡潔に書くためのユーティリティコマンドです。

引数にはテキストノードのみを指定し、コマンドは含めないでください。

### 定義済み識別子 (`varbeta`, `varepsilon`, ･･･)
```
\varbeta>  ≅ \i<ϐ>
  ⋮
```
ギリシャ文字の異体字など、入力しづらい識別子をコマンドとして記述するためのユーティリティコマンドです。
引数は不要です。

定義されている識別子は、[定義ファイル](../../source/zotica/resource/math.json) の `identifier` キーを参照してください。

### 定義済み関数 (`sin`, `cos`, ･･･)
```
\sin>  ≅ \i|fun,rm|<sin>
  ⋮
```
汎用の関数名はそれぞれ 1 つのコマンドとしてあらかじめ定義してあります。
引数は不要です。

定義されている関数は、[定義ファイル](../../source/zotica/resource/math.json) の `function` キーを参照してください。

### 定義済み記号 (`pm`, `times`, ･･･)
```
\pm>  ≅ \o|bin|<±>
  ⋮
```
だいたいの数学記号は、それを出力するためのユーティリティコマンドが用意されています。
全て引数は不要です。

このユーティリティコマンドを仕様すると、自動的にあらかじめ定義されているアトムクラスが付けられます。
コマンドにアトムクラスを明示的に指定することで、あらかじめ定義されたアトムクラスを上書きすることができます。

定義されている記号とアトムクラスは、[定義ファイル](../../source/zotica/resource/math.json) の `operator` キーを参照してください。

### 括弧 (`paren`, `pparen`, ･･･)

### 下付きと上付き (`sb`, `sp`, `sbsp`)

### アンダースクリプトとオーバースクリプト (`un`, `ov`)

### 積分様記号 (`int`, `iint`, ･･･)

### 総和様記号 (`sum`, `prod`, ･･･)

### アクセント付き文字 (`tilde`, `hat`, ･･･)

### 伸縮アクセント付き文字 (`widetilde`, `widehat`, ･･･)

### 各種表 (`array`, `stack`, `matrix`)

### 場合分け (`case`)

### 表の 1 行分のセル (`cc`)

### 図式の 1 行分のセル (`vv`)

### 一方向の空間の確保 (`vph`, `hph`)

### スペース (`sbin`, `srel`, ･･･)